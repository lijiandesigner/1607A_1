@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutPage1.cshtml";
}

@*<meta property="twitter:card" content="summary_large_image">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">*@
@*<meta name="viewport" content="width=device-width, initial-scale=1">*@
<!-- Main CSS-->
@*<link href="~/Content/main.css" rel="stylesheet" />*@
<!-- Font-icon css-->
@*<link href="~/Content/bootstrap.min.css" rel="stylesheet" />*@
<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
@*<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">*@
<h2 style="text-align:center">请假信息表</h2>
<div>
    <span runat="server">员工编号</span><input id="TxtENo" type="text" />
    <select id="SelRestType">
        <option value="选择请假类型">选择请假类型</option>
        <option value="事假">事假</option>
        <option value="病假">病假</option>
        <option value="婚假">婚假</option>
        <option value="产假">产假</option>
        <option value="丧假">丧假</option>
    </select>
    <input id="btnSelect" type="button" class="btn-info" value="查询" />
</div>
<div class="col-md-12">
    <div class="tile">
        <div class="tile-body">
            <table class="table table-bordered table-hover" id="sampleTable">
                <thead>
                    <tr>
                        <th>员工编号</th>
                        <th>员工姓名</th>
                        <th>员工职位</th>
                        <th>请假类型</th>
                        <th>开始时间</th>
                        <th>结束时间</th>
                        <th>请假理由</th>
                        <th>审核时间</th>
                        <th>审核状态</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="tb"></tbody>
            </table>
        </div>
    </div>
</div>
<script>
    $(function () {
        $("#btnSelect").click(function () {
            if ($("#TxtENo").val() != "" & $("#SelRestType").val() == "选择请假类型") {
                eno = $("#TxtENo").val();
                rtype = $("#SelRestType").val();

                $.ajax({
                    url: 'http://localhost:59776/api/Rest?ENo=' + eno + '&Rtype=' + '',
                    type: 'get',
                    success: function (data) {
                        var str = "";
                        for (var i in data) {
                            str += "<tr><td>" + data[i].ENo + "</td><td>" + data[i].Ename + "</td><td>" + data[i].PoName + "</td><td>" + data[i].Rtype + "</td><td>" + data[i].RBeginTime + "</td><td>" + data[i].REndTime + "</td><td>" + data[i].RemarkInfo + "</td><td>" + data[i].ReAuditTime + "</td><td><span id='s" + data[i].RID + "'>" + data[i].Restatic + "</span></td><td><input id='btnAgree' type='button' onclick='Agree(" + data[i].RID + ")' value='同意' /><input id='btnReject' type='button' onclick='Reject(" + data[i].RID + ")' value='驳回' /></td></tr>";
                        }
                        $("#tb").html(str);
                    }
                });
            }

            else if ($("#SelRestType").val() != "选择请假类型" & $("#TxtENo").val() == "") {
                eno = $("#TxtENo").val();
                rtype = $("#SelRestType").val();
                $.ajax({
                    url: 'http://localhost:59776/api/Rest?ENo=' + '' + '&Rtype=' + rtype,
                    type: 'get',
                    success: function (data) {
                        var str = "";
                        for (var i in data) {
                            str += "<tr><td>" + data[i].ENo + "</td><td>" + data[i].Ename + "</td><td>" + data[i].PoName + "</td><td>" + data[i].Rtype + "</td><td>" + data[i].RBeginTime + "</td><td>" + data[i].REndTime + "</td><td>" + data[i].RemarkInfo + "</td><td>" + data[i].ReAuditTime + "</td><td><span id='s" + data[i].RID + "'>" + data[i].Restatic + "</span></td><td><input id='btnAgree' type='button' onclick='Agree(" + data[i].RID + ")' value='同意' /><input id='btnReject' type='button' onclick='Reject(" + data[i].RID + ")' value='驳回' /></td></tr>";
                        }
                        $("#tb").html(str);
                    }
                });
            }
            else {
                eno = $("#TxtENo").val();
                rtype = $("#SelRestType").val();
                $.ajax({
                    url: 'http://localhost:59776/api/Rest?ENo=' + eno + '&Rtype=' + rtype,
                    type: 'get',
                    success: function (data) {
                        var str = "";
                        for (var i in data) {
                            str += "<tr><td>" + data[i].ENo + "</td><td>" + data[i].Ename + "</td><td>" + data[i].PoName + "</td><td>" + data[i].Rtype + "</td><td>" + data[i].RBeginTime + "</td><td>" + data[i].REndTime + "</td><td>" + data[i].RemarkInfo + "</td><td>" + data[i].ReAuditTime + "</td><td><span id='s" + data[i].RID + "'>" + data[i].Restatic + "</span></td><td><input id='btnAgree' type='button' onclick='Agree(" + data[i].RID + ")' value='同意' /><input id='btnReject' type='button' onclick='Reject(" + data[i].RID + ")' value='驳回' /></td></tr>";
                        }
                        $("#tb").html(str);

                    }
                });
            }

        });
    });
    //function SelectLoad() {
    //    eno = $("#TxtENo").val();
    //    rtype = $("#SelRestType").val();
    //    $.ajax({
    //        url: 'http://localhost:59776/api/Rest?ENo=' + eno + '&Rtype=' + rtype,
    //        type: 'get',
    //        success: function (data) {
    //            $("#tb").empty();
    //            for (var i in data) {
    //                $("#tb").append("<tr><td>" + data[i].ENo + "</td><td>" + data[i].Ename + "</td><td>" + data[i].PoName + "</td><td>" + data[i].Rtype + "</td><td>" + data[i].RBeginTime + "</td><td>" + data[i].REndTime + "</td><td>" + data[i].RemarkInfo + "</td><td>" + data[i].ReAuditTime + "</td><td><span id='s" + data[i].RID + "'>" + data[i].Restatic + "</span></td><td><input id='btnAgree' type='button' onclick='Agree(" + data[i].RID + ")' value='同意' /><input id='btnReject' type='button' onclick='Reject(" + data[i].RID + ")' value='驳回' /></td></tr>");
    //            }

    //        }
    //    });
    //}
</script>
<script>
    function loadData() {
        $(function () {
            eno = $("#TxtENo").val();
            rtype = $("#SelRestType").val();
            $.ajax({
                url: 'http://localhost:59776/api/Rest',
                type: 'get',
                dataType: 'json',
                success: function (data) {
                    var str = "";
                    for (var i in data) {
                        str += "<tr><td>" + data[i].ENo + "</td><td>" + data[i].Ename + "</td><td>" + data[i].PoName + "</td><td>" + data[i].Rtype + "</td><td>" + data[i].RBeginTime + "</td><td>" + data[i].REndTime + "</td><td>" + data[i].RemarkInfo + "</td><td>" + data[i].ReAuditTime + "</td><td><span id='s" + data[i].RID + "'>" + data[i].Restatic + "</span></td><td><input id='btnAgree' type='button' onclick='Agree(" + data[i].RID + ")' value='同意' /><input id='btnReject' type='button' onclick='Reject(" + data[i].RID + ")' value='驳回' /></td></tr>";
        }
                    $("#tb").html(str);
                }
            });
        });
    }
    $(function () {
        loadData();
    })
    function Agree(RID) {
        $.ajax({
            url: 'http://localhost:59776/api/Rest?RID=' + RID + '&Restatic=1',
            type: 'put',
            dataType: 'text',
            success: function (data) {
                if (data > 0) {
                    alert("审批成功");
                }
            }
        })
        document.getElementById("s" + RID).innerText = "同意";
        //loadData();
    }
    function Reject(RID) {
        $.ajax({
            url: 'http://localhost:59776/api/Rest?RID=' + RID + '&Restatic=0',
            type: 'put',
            dataType: 'text',
            success: function (data) {
                if (data > 0) {
                    alert("审批成功");
                }
            }
        })
        document.getElementById("s" + RID).innerText = "驳回";
        //loadData();
    }

</script>
@*<!-- Essential javascripts for application to work-->
<script src="~/Scripts/js/jquery-3.2.1.min.js"></script>
<script src="~/Scripts/js/popper.min.js"></script>
<script src="~/Scripts/js/bootstrap.min.js"></script>
<script src="~/Scripts/js/main.js"></script>
<!-- The javascript plugin to display page loading on top-->
<script src="~/Scripts/js/plugins/pace.min.js"></script>
<!-- Page specific javascripts-->
<!-- Data table plugin-->
<script type="text/javascript" src="~/Scripts/js/plugins/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="~/Scripts/js/plugins/dataTables.bootstrap.min.js"></script>
<script type="text/javascript">$('#sampleTable').DataTable();</script>
<!-- Google analytics script-->
<script type="text/javascript">
    if (document.location.hostname == 'pratikborsadiya.in') {
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-72504830-1', 'auto');
        ga('send', 'pageview');
    }
</script>*@
